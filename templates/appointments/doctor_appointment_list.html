{% extends 'includes/base.html' %}
{% load static %}

{% block title %}Doctor Appointments{% endblock %}

{% block use_dna_right %}
<canvas id="dna-right" class="dna-canvas right"></canvas>
{% endblock %}

{% block content %}
<section class="hero-section position-relative">
  <div class="container text-white text-center py-5 page-container">

    <h2 class="fancy-text text-glow mb-5">
      Doctor Dashboard â€“ Appointments
    </h2>

    <div class="d-flex flex-column gap-5">

      <!-- Confirmed Appointments -->
      <div class="glass-card px-4 py-5 rounded-4 mx-auto border border-info shadow-lg text-start text-white w-100"
           style="max-width: 1000px;">
        <h4 class="dashboard-title text-white text-center">Confirmed Appointments</h4>
        {% if confirmed_appointments %}
          <ul class="list-group glass-card mt-3">
            {% for appointment in confirmed_appointments %}
              <li class="list-group-item bg-transparent border-light text-white mb-3">
                <strong>Patient:</strong> {{ appointment.patient.email }}<br>
                <strong>Date:</strong> {{ appointment.appointment_datetime|date:'d.m.Y H:i' }}<br>
                {% if appointment.reason %}
                  <strong>Reason:</strong> {{ appointment.reason }}<br>
                {% endif %}
                <div class="mt-3 d-flex justify-content-between align-items-center flex-wrap">
                  <span class="badge bg-success">Confirmed</span>
                  <form method="post" action="{% url 'appointment_cancel' appointment.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      Cancel
                    </button>
                  </form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mt-3 text-center">No confirmed appointments.</p>
        {% endif %}
      </div>

      <!-- Pending Appointments -->
      <div class="glass-card px-4 py-5 rounded-4 mx-auto border border-warning shadow-lg text-start text-white w-100"
           style="max-width: 1000px;">
        <h4 class="dashboard-title text-white text-center">Pending Appointment Requests</h4>
        {% if pending_appointments %}
          <ul class="list-group glass-card mt-3">
            {% for appointment in pending_appointments %}
              <li class="list-group-item bg-transparent border-light text-white mb-3">
                <strong>Patient:</strong> {{ appointment.patient.email }}<br>
                <strong>Date:</strong> {{ appointment.appointment_datetime|date:'d.m.Y H:i' }}<br>
                {% if appointment.reason %}
                  <strong>Reason:</strong> {{ appointment.reason }}<br>
                {% endif %}
                <div class="mt-3 text-end">
                  <form method="post" action="{% url 'appointment_approve' appointment.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-success">
                      Approve
                    </button>
                  </form>
                  <form method="post" action="{% url 'appointment_reject' appointment.pk %}" class="d-inline ms-2">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      Reject
                    </button>
                  </form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mt-3 text-center">No pending requests.</p>
        {% endif %}
      </div>

    </div>
  </div>
</section>
{% endblock %}
