{% extends 'includes/base.html' %}
{% load static %}

{% block title %}My Patients{% endblock %}

{% block use_network %}
<canvas id="dna-right" class="dna-canvas right"></canvas>
{% endblock %}

{% block use_container %}
<section class="hero-section">
  <div class="container mt-5 text-white hero-content">
    <h2 class="fancy-text mb-4 text-center">My Patient Connections</h2>

    {% include 'includes/messages.html' %}

    {% if links %}
      <div class="table-responsive">
        <table class="table glass-table">
          <thead>
            <tr>
              <th>Patient</th>
              <th>Direction</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for link in links %}
              <tr>
                <td class="text-start">
                  {% if link.patient.profile.full_name %}
                    <strong>{{ link.patient.profile.full_name }}</strong><br>
                    <small class="text-muted">{{ link.patient.email }}</small>
                  {% else %}
                    {{ link.patient.email }}
                  {% endif %}
                </td>
                <td class="text-capitalize">{{ link.direction }}</td>
                <td>{{ link.status|capfirst }}</td>
                <td>
                  {% if link.status == 'approved' %}
                    <div class="d-flex flex-column flex-md-row gap-2 justify-content-center">
                      <form method="post" action="{% url 'doctor-cancel-link' link.pk %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-danger">Cancel</button>
                      </form>
                      <a href="{% url 'doctor-patient-detail' link.patient.pk %}" class="btn btn-sm btn-outline-info">
                        <i class="fas fa-user-md me-1"></i> View Data
                      </a>
                    </div>
                  {% else %}
                    <span class="text-muted">â€“</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info mt-4 text-center">
        You have no patient connections yet.
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
